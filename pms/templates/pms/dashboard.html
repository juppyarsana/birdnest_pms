{% load humanize %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hotel PMS Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: #f8f9fa; }
        .dashboard-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 2rem; }
        .dashboard-title { font-weight: 700; }
        .stat-card { border-radius: 1rem; box-shadow: 0 2px 8px rgba(0,0,0,0.04); }
        .table thead { background: #f1f3f4; }
        .table th, .table td { vertical-align: middle; }
        .section-title { margin-top: 2.5rem; margin-bottom: 1rem; font-weight: 600; }
    </style>
</head>
<body>
    <div class="container py-4">
        <div class="dashboard-header">
            <h1 class="dashboard-title">Hotel Dashboard <span class="fs-5 text-muted">({{ rooms|length }} Rooms)</span></h1>
            <div>
                <a href="{% url 'create_reservation' %}" class="btn btn-primary me-2">New Reservation</a>
                <a href="{% url 'reservations_list' %}" class="btn btn-info me-2">View Reservations</a>
                <a href="{% url 'calendar' %}" class="btn btn-outline-secondary">View Calendar</a>
            </div>
        </div>
        <div class="row g-3 mb-4">
            <div class="col-md-4">
                <div class="card stat-card text-center p-3">
                    <div class="fs-6 text-muted">Daily Occupancy</div>
                    <div class="fs-2 fw-bold">{{ daily_occupancy|floatformat:1 }}%</div>
                    <div class="text-muted">Target: {{ target_occupancy }}%</div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card stat-card text-center p-3">
                    <div class="fs-6 text-muted">Monthly Occupancy</div>
                    <div class="fs-2 fw-bold">{{ monthly_occupancy|floatformat:1 }}%</div>
                    <div class="text-muted">{{ month_name }}</div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card stat-card text-center p-3">
                    <div class="fs-6 text-muted">Total Reservations</div>
                    <div class="fs-2 fw-bold">{{ all_reservations|length }}</div>
                    <div class="text-muted">in database</div>
                </div>
            </div>
        </div>
        <div class="col-12 mb-4">
            <div class="card stat-card p-3">
                <h3 class="section-title">Rooms</h3>
                <div class="table-responsive">
                    <table class="table table-hover align-middle">
                        <thead class="table-light">
                            <tr>
                                <th>Room</th>
                                <th>Type</th>
                                <th>Rate</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for room in rooms %}
                            <tr>
                                <td>{{ room.room_number }}</td>
                                <td>{{ room.room_type|title }}</td>
                                <td>Rp {{ room.rate|intcomma }}</td>
                                <td>
                                    {% if room.status == 'occupied' %}
                                        <span class="badge bg-danger">Occupied</span>
                                    {% else %}
                                        <span class="badge bg-success">Available</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="col-12 mb-4">
            <div class="card stat-card p-3">
                <h3 class="section-title">Pending Reservations</h3>
                <div class="table-responsive">
                    <table class="table table-hover align-middle">
                        <thead class="table-light">
                            <tr>
                                <th>Guest</th>
                                <th>Room</th>
                                <th>Check-In</th>
                                <th>Check-Out</th>
                                <th>Status</th>
                                <th>Payment Method</th>
                                <th>Payment Notes</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for reservation in pending_reservations %}
                            <tr>
                                <td>{{ reservation.guest.name }}</td>
                                <td>{{ reservation.room.room_number }}</td>
                                <td>{{ reservation.check_in }}</td>
                                <td>{{ reservation.check_out }}</td>
                                <td>{{ reservation.status }}</td>
                                <td>{{ reservation.get_payment_method_display|default:"Not Specified" }}</td>
                                <td>{{ reservation.payment_notes|default:"None" }}</td>
                                <td><a href="{% url 'confirm_reservation' reservation.id %}" class="btn btn-sm btn-success">Confirm</a></td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="8">No pending reservations</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="card mb-4 p-3">
        <h3 class="section-title">Expected Arrivals</h3>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Guest</th>
                    <th>Room</th>
                    <th>Check-In</th>
                    <th>Check-Out</th>
                    <th>Status</th>
                    <th>Payment Method</th>
                    <th>Payment Notes</th>
                </tr>
            </thead>
            <tbody>
                {% for reservation in expected_arrivals %}
                <tr>
                    <td>{{ reservation.guest.name }}</td>
                    <td>{{ reservation.room.room_number }}</td>
                    <td>{{ reservation.check_in }}</td>
                    <td>{{ reservation.check_out }}</td>
                    <td>{{ reservation.status }}</td>
                    <td>{{ reservation.get_payment_method_display|default:"Not Specified" }}</td>
                    <td>{{ reservation.payment_notes|default:"None" }}</td>
                    <td>
                        <a href="{% url 'checkin_reservation' reservation.id %}" class="btn btn-sm btn-primary">Check-In</a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="7">No expected arrivals</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        </div>
        <div class="col-12 mb-4">
            <div class="card stat-card p-3">
                <h3 class="section-title">Expected Departures</h3>
                <div class="table-responsive">
                    <table class="table table-hover align-middle">
                        <thead class="table-light">
                            <tr>
                                <th>Guest</th>
                                <th>Room</th>
                                <th>Check-In</th>
                                <th>Check-Out</th>
                                <th>Status</th>
                                <th>Payment Method</th>
                                <th>Payment Notes</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for reservation in expected_departures %}
                            <tr>
                                <td>{{ reservation.guest.name }}</td>
                                <td>{{ reservation.room.room_number }}</td>
                                <td>{{ reservation.check_in }}</td>
                                <td>{{ reservation.check_out }}</td>
                                <td>{{ reservation.status }}</td>
                                <td>{{ reservation.get_payment_method_display|default:"Not Specified" }}</td>
                                <td>{{ reservation.payment_notes|default:"None" }}</td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="7">No expected departures</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="card mb-4 p-3">
        <h3 class="section-title">Canceled Reservations</h3>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Guest</th>
                    <th>Room</th>
                    <th>Check-In</th>
                    <th>Check-Out</th>
                    <th>Status</th>
                    <th>Payment Method</th>
                    <th>Payment Notes</th>
                </tr>
            </thead>
            <tbody>
                {% for reservation in canceled_reservations %}
                <tr>
                    <td>{{ reservation.guest.name }}</td>
                    <td>{{ reservation.room.room_number }}</td>
                    <td>{{ reservation.check_in }}</td>
                    <td>{{ reservation.check_out }}</td>
                    <td>{{ reservation.status }}</td>
                    <td>{{ reservation.get_payment_method_display|default:"Not Specified" }}</td>
                    <td>{{ reservation.payment_notes|default:"None" }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="7">No canceled reservations</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        </div>
        <div class="card mb-4 p-3">
        <h3 class="section-title">No-Show Reservations</h3>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Guest</th>
                    <th>Room</th>
                    <th>Check-In</th>
                    <th>Check-Out</th>
                    <th>Status</th>
                    <th>Payment Method</th>
                    <th>Payment Notes</th>
                </tr>
            </thead>
            <tbody>
                {% for reservation in no_show_reservations %}
                <tr>
                    <td>{{ reservation.guest.name }}</td>
                    <td>{{ reservation.room.room_number }}</td>
                    <td>{{ reservation.check_in }}</td>
                    <td>{{ reservation.check_out }}</td>
                    <td>{{ reservation.status }}</td>
                    <td>{{ reservation.get_payment_method_display|default:"Not Specified" }}</td>
                    <td>{{ reservation.payment_notes|default:"None" }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="7">No no-show reservations</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        </div>
        <div class="card mb-4 p-3">
        <h3 class="section-title">All Reservations (Debug)</h3>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Guest</th>
                    <th>Room</th>
                    <th>Check-In</th>
                    <th>Check-Out</th>
                    <th>Status</th>
                    <th>Payment Method</th>
                    <th>Payment Notes</th>
                </tr>
            </thead>
            <tbody>
                {% for reservation in all_reservations %}
                <tr>
                    <td>{{ reservation.guest.name }}</td>
                    <td>{{ reservation.room.room_number }}</td>
                    <td>{{ reservation.check_in }}</td>
                    <td>{{ reservation.check_out }}</td>
                    <td>{{ reservation.status }}</td>
                    <td>{{ reservation.get_payment_method_display|default:"Not Specified" }}</td>
                    <td>{{ reservation.payment_notes|default:"None" }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="7">No reservations in database</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        </div>
    </div>
</body>
</html>